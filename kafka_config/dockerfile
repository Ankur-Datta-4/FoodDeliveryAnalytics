FROM openjdk:8-jre-slim

ARG KAFKA_VERSION=2.8.0
ARG SCALA_VERSION=2.13

# Install required packages
RUN apt-get update && \
    apt-get install -y wget netcat && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Download and extract Kafka
RUN wget -q https://downloads.apache.org/kafka/${KAFKA_VERSION}/kafka_${SCALA_VERSION}-${KAFKA_VERSION}.tgz && \
    tar -xzf kafka_${SCALA_VERSION}-${KAFKA_VERSION}.tgz && \
    rm kafka_${SCALA_VERSION}-${KAFKA_VERSION}.tgz && \
    mv kafka_${SCALA_VERSION}-${KAFKA_VERSION} /kafka

WORKDIR /kafka

# Set environment variables
ENV KAFKA_HOME=/kafka
ENV PATH=$PATH:$KAFKA_HOME/bin
ENV KAFKA_LOG_DIRS=/kafka/logs
ENV KAFKA_ZOOKEEPER_CONNECT=zookeeper:2181

# Copy configuration files
COPY config/server.properties config/
COPY config/zookeeper.properties config/

# Copy scripts to start Kafka and wait for Zookeeper
COPY scripts/start-kafka.sh /usr/bin/start-kafka.sh
COPY scripts/wait-for-zookeeper.sh /usr/bin/wait-for-zookeeper.sh
RUN chmod +x /usr/bin/start-kafka.sh /usr/bin/wait-for-zookeeper.sh

# Set the entrypoint to start Kafka
ENTRYPOINT ["start-kafka.sh"]
